<p-toast></p-toast>

<div class="admin-container">
    <app-sidebar></app-sidebar>
    <header class="admin-header">
        <h1>Artist Management</h1>
        <p class="subtitle">Manage your artists effortlessly</p>
    </header>

    <main class="content-area">
        <!-- New Artist Form -->
        <section class="form-section">
            <div class="form-card">
                <header class="card-header">
                    <h2>Create New Artist</h2>
                    <i class="pi pi-plus-circle"></i>
                </header>
                <form (ngSubmit)="saveArtist()" #artistForm="ngForm" class="atelier-form">
                    <div class="form-grid">
                        <div class="form-field">
                            <label for="email">
                                <i class="pi pi-envelope"></i> Email
                            </label>
                            <input id="email" type="email" pInputText [(ngModel)]="newArtist.email" 
                                name="email" required placeholder="Enter email" />
                        </div>
                        <div class="form-field">
                            <label for="nom">
                                <i class="pi pi-user"></i> Nom
                            </label>
                            <input id="nom" type="text" pInputText [(ngModel)]="newArtist.nom" 
                                name="nom" required placeholder="Enter last name" />
                        </div>
                        <div class="form-field">
                            <label for="prenom">
                                <i class="pi pi-user"></i> Prénom
                            </label>
                            <input id="prenom" type="text" pInputText [(ngModel)]="newArtist.prenom" 
                                name="prenom" required placeholder="Enter first name" />
                        </div>
                        <div class="form-field">
                            <label for="numero">
                                <i class="pi pi-phone"></i> Num Tel
                            </label>
                            <input id="numero" type="text" pInputText [(ngModel)]="newArtist.numero" 
                                name="numero" required placeholder="Enter phone number" />
                        </div>
                        <div class="form-field">
                            <label for="image">
                                <i class="pi pi-image"></i> Image
                            </label>
                            <input id="image" type="file" (change)="onFileChange($event)" />
                        </div>
                    </div>
                    <footer class="form-actions">
                        <p-button label="Ajouter" icon="pi pi-plus" type="submit" 
                            styleClass="p-button-success p-button-raised"></p-button>
                    </footer>
                </form>
            </div>
        </section>

        <!-- Artist List -->
        <section class="list-section">
            <div class="list-card">
                <header class="card-header">
                    <h2>Artist List</h2>
                    <i class="pi pi-list"></i>
                </header>
                <p-table [value]="artists" 
                    [paginator]="true" 
                    [rows]="5" 
                    [showCurrentPageReport]="true"
                    currentPageReportTemplate="Showing {first} to {last} of {totalRecords} artistes"
                    [rowsPerPageOptions]="[5,10,20]"
                    styleClass="p-datatable-gridlines p-datatable-sm"
                    [tableStyle]="{'width': '100%'}"
                    responsiveLayout="scroll">
                    <ng-template pTemplate="header">
                        <tr>
                            <th>ID</th>
                            <th>Email</th>
                            <th>Image</th>
                            <th>Nom</th>
                            <th>Prénom</th>
                            <th>Num Tel</th>
                            <th>Actions</th>
                        </tr>
                    </ng-template>
                    <ng-template pTemplate="body" let-artist>
                        <tr>
                            <td>{{artist.id}}</td>
                            <td>
                                <ng-container *ngIf="!isEditing(artist)">
                                    {{artist.email}}
                                </ng-container>
                                <ng-container *ngIf="isEditing(artist)">
                                    <input pInputText type="email" [(ngModel)]="editedArtist.email">
                                </ng-container>
                            </td>
                            <td>
                                <img [src]="url + '/' + artist.image" alt="Image de l'artiste" style="width: 40px; height: 40px;"/>
                            </td>
                            <td>
                                <ng-container *ngIf="!isEditing(artist)">
                                    {{artist.nom}}
                                </ng-container>
                                <ng-container *ngIf="isEditing(artist)">
                                    <input pInputText type="text" [(ngModel)]="editedArtist.nom">
                                </ng-container>
                            </td>
                            <td>
                                <ng-container *ngIf="!isEditing(artist)">
                                    {{artist.prenom}}
                                </ng-container>
                                <ng-container *ngIf="isEditing(artist)">
                                    <input pInputText type="text" [(ngModel)]="editedArtist.prenom">
                                </ng-container>
                            </td>
                            <td>
                                <ng-container *ngIf="!isEditing(artist)">
                                    {{artist.numero}}
                                </ng-container>
                                <ng-container *ngIf="isEditing(artist)">
                                    <input pInputText type="tel" [(ngModel)]="editedArtist.numero">
                                </ng-container>
                            </td>
                            <td class="actions-cell">
                                <div class="action-buttons">
                                    <p-button [icon]="isEditing(artist) ? 'pi pi-check' : 'pi pi-pencil'" 
                                        (click)="toggleEdit(artist)"
                                        [styleClass]="isEditing(artist) ? 'p-button-rounded p-button-success mr-2' : 'p-button-rounded p-button-info mr-2'"
                                        pTooltip="Edit Artist">
                                    </p-button>
                                    <ng-container *ngIf="isEditing(artist)">
                                        <p-button icon="pi pi-times" 
                                            (click)="cancelEdit(artist)"
                                            styleClass="p-button-rounded p-button-danger mr-2"
                                            pTooltip="Cancel Edit">
                                        </p-button>
                                    </ng-container>
                                    <p-button *ngIf="!isEditing(artist)" icon="pi pi-palette" 
                                        (click)="manageTableaux(artist)"
                                        styleClass="p-button-rounded p-button-warning mr-2"
                                        pTooltip="Manage Tableaux">
                                    </p-button>
                                    <p-button *ngIf="!isEditing(artist)" icon="pi pi-trash" 
                                        (click)="DeleteArtist(artist.id)"
                                        styleClass="p-button-rounded p-button-danger"
                                        pTooltip="Delete Artist">
                                    </p-button>
                                </div>
                            </td>
                        </tr>
                    </ng-template>
                    <ng-template pTemplate="emptymessage">
                        <tr>
                            <td colspan="7" class="empty-message">
                                <i class="pi pi-info-circle"></i>
                                <span>No artists found</span>
                            </td>
                        </tr>
                    </ng-template>
                </p-table>
            </div>
        </section>
    </main>
</div>

<!-- Tableau Management Dialog -->
<p-dialog header="Manage Tableaux" 
    [(visible)]="tableauDialogVisible" 
    [modal]="true" 
    [style]="{width: '90vw', maxWidth: '1200px'}" 
    [closable]="true"
    [maximizable]="true">
    
    <div class="tableau-management">
        <!-- Add New Tableau Form -->
        <div class="tableau-form-section">
            <h3>Add New Tableau</h3>
            <form (ngSubmit)="addTableau()" #tableauForm="ngForm" class="tableau-form">
                <div class="form-grid">
                    <div class="form-field">
                        <label for="titre">
                            <i class="pi pi-tag"></i> Title
                        </label>
                        <input id="titre" type="text" pInputText 
                            [(ngModel)]="newTableau.titre" 
                            name="titre" required 
                            placeholder="Enter tableau title" />
                    </div>
                    <div class="form-field">
                        <label for="description">
                            <i class="pi pi-file-o"></i> Description
                        </label>
                        <textarea id="description" pInputTextarea 
                            [(ngModel)]="newTableau.Description" 
                            name="description" required 
                            placeholder="Enter tableau description"
                            rows="3">
                        </textarea>
                    </div>
                    <div class="form-field">
                        <label for="tableauImage">
                            <i class="pi pi-image"></i> Image
                        </label>
                        <input id="tableauImage" type="file" 
                            (change)="onTableauFileChange($event)" 
                            accept="image/*" />
                        <!-- Progress bar for image upload -->
                        <div *ngIf="progress > 0 && progress < 100" class="progress-container">
                            <p-progressBar [value]="progress" 
                                [showValue]="true" 
                                styleClass="upload-progress">
                            </p-progressBar>
                            <small>Uploading image to blob storage...</small>
                        </div>
                        <div *ngIf="tableauFile" class="file-info">
                            <small><i class="pi pi-file"></i> Selected: {{tableauFile.name}}</small>
                        </div>
                    </div>
                </div>
                <div class="form-actions">
                    <p-button label="Add Tableau" icon="pi pi-plus" 
                        type="submit" 
                        styleClass="p-button-success"
                        [disabled]="!tableauForm.valid">
                    </p-button>
                </div>
            </form>
        </div>

        <!-- Existing Tableaux List -->
        <div class="tableau-list-section">
            <h3>Existing Tableaux for {{selectedArtist?.nom}} {{selectedArtist?.prenom}}</h3>
            <p-table [value]="artistTableaux" 
                [paginator]="true" 
                [rows]="5" 
                styleClass="p-datatable-gridlines p-datatable-sm"
                [tableStyle]="{'width': '100%'}"
                responsiveLayout="scroll">
                <ng-template pTemplate="header">
                    <tr>
                        <th>ID</th>
                        <th>Image</th>
                        <th>Title</th>
                        <th>Description</th>
                        <th>Actions</th>
                    </tr>
                </ng-template>
                <ng-template pTemplate="body" let-tableau>
                    <tr>
                        <td>{{tableau.id}}</td>
                        <td>
                            <img [src]="url + '/' + tableau.image" 
                                alt="Tableau image" 
                                style="width: 60px; height: 60px; object-fit: cover; border-radius: 4px;"
                                *ngIf="tableau.image"/>
                            <span *ngIf="!tableau.image" class="no-image">No Image</span>
                        </td>
                        <td>{{tableau.titre}}</td>
                        <td>{{tableau.Description}}</td>
                        <td>
                            <p-button icon="pi pi-trash" 
                                (click)="deleteTableau(tableau.id)"
                                styleClass="p-button-rounded p-button-danger p-button-sm"
                                pTooltip="Delete Tableau">
                            </p-button>
                        </td>
                    </tr>
                </ng-template>
                <ng-template pTemplate="emptymessage">
                    <tr>
                        <td colspan="5" class="empty-message">
                            <i class="pi pi-info-circle"></i>
                            <span>No tableaux found for this artist</span>
                        </td>
                    </tr>
                </ng-template>
            </p-table>
        </div>
    </div>
</p-dialog>

<p-confirmDialog [style]="{width: '50vw'}" [baseZIndex]="10000" rejectButtonStyleClass="p-button-text"></p-confirmDialog>